# Ralph Loop Progress

Format per entry:
- timestamp:
- item:
- summary:
- decisions:
- files:
- validation:
- commit:

---

- timestamp: 2026-02-11
- item: RL-000
- summary: Bootstrapped Codex Ralph loop harness (HITL + AFK scripts, PRD, prompt, progress tracking).
- decisions: Use Codex `gpt-5.3-codex` model with YOLO-equivalent bypass mode for autonomous iterations.
- files: ralph/prd.json, ralph/prompt.md, ralph/progress.txt, scripts/ralph-once.sh, scripts/afk-ralph.sh
- validation: bash -n scripts/ralph-once.sh scripts/afk-ralph.sh; scripts/ralph-once.sh --dry-run; scripts/afk-ralph.sh 1 --dry-run
- commit: pending
- timestamp: 2026-02-11
- item: RL-016
- summary: Completed deterministic terrain generation pipeline from server seed metadata to client tile rendering with terrain/resource layers.
- decisions: Persist per-room `terrain_seed` in DO `room_meta`; expose terrain config via `features.terrain` every snapshot; centralize deterministic terrain sampling (`sample_terrain`) in `sim-core` for server/client parity and future resource loops.
- files: sim-core/src/lib.rs, worker/src/lib.rs, src/game/types.ts, src/game/netcode/replication.ts, game-client/src/lib.rs, ralph/prd.json, ralph/progress.txt
- validation: cargo test --manifest-path sim-core/Cargo.toml; cargo check --manifest-path worker/Cargo.toml; cargo check --manifest-path game-client/Cargo.toml --target wasm32-unknown-unknown; npm run build
- commit: b8765e1

- timestamp: 2026-02-11
- item: RL-001
- summary: Added a dedicated shared gameplay domain module in `sim-core` with versioned schema contracts for resources, recipes, inventory, combat stats, placeables, and deterministic simulation tick IO.
- decisions: Keep shared model in `sim-core::domain` to avoid UI coupling; use explicit `schema_version` on state/input/output (`GAMEPLAY_SCHEMA_VERSION = 1`); drive deterministic tick behavior with ordered structures (`BTreeMap`) and pure `simulate_step` command/event flow.
- files: sim-core/src/domain.rs, sim-core/src/lib.rs, sim-core/Cargo.toml, sim-core/Cargo.lock, worker/Cargo.lock, game-client/Cargo.lock, ralph/prd.json, ralph/progress.txt
- validation: cargo fmt --manifest-path sim-core/Cargo.toml; cargo test --manifest-path sim-core/Cargo.toml (13 passed); cargo check --manifest-path worker/Cargo.toml; cargo check --manifest-path game-client/Cargo.toml --target wasm32-unknown-unknown; npm run build
- commit: 1f52970

- timestamp: 2026-02-11
- item: RL-002
- summary: Completed protocol v2 envelope expansion for inventory/mining/crafting/combat/character channels with strict client/server validation and compact delta-safe snapshot behavior.
- decisions: Promote protocol feature names to explicit enums/unions on both worker and web client; treat malformed/unsupported payloads as safe rejects; emit new gameplay snapshot channels as compact schemas (full snapshot baseline + delta-preserved merge path) while keeping existing build/movement/projectile behavior server-authoritative.
- files: src/game/types.ts, src/game/network-client.ts, src/game/netcode/replication.ts, worker/src/lib.rs, ralph/prd.json, ralph/progress.txt
- validation: cargo fmt --manifest-path worker/Cargo.toml; cargo check --manifest-path worker/Cargo.toml; npm run build:web
- commit: a1357eb

- timestamp: 2026-02-11
- item: RL-003
- summary: Added durable character profile persistence keyed by user/character id with active profile selection and server snapshot integration.
- decisions: Store profiles in `character_profiles(user_id, character_id)` and active selection in `active_character_profiles(user_id)`; implement `character.set_profile` upsert + `character.set_active`; backfill legacy `presence_players` into default profiles on schema init and document migration behavior in architecture docs.
- files: worker/src/lib.rs, docs/networking-architecture.md, ralph/prd.json, ralph/progress.txt
- validation: cargo fmt --manifest-path worker/Cargo.toml; cargo check --manifest-path worker/Cargo.toml; npm run build:web
- commit: da62676

- timestamp: 2026-02-11
- item: RL-004
- summary: Implemented a pre-room character selector with three editable slots, room-scoped server rehydration, and active slot persistence before room connect.
- decisions: Add room DO HTTP endpoint `/api/rooms/:roomCode/character-profiles` (`GET` + `PUT`) so selector state can load/save before websocket connect; keep slot ids stable (`default`, `slot-02`, `slot-03`) and treat worker-side validation failures as safe 400 responses.
- files: worker/src/lib.rs, src/game/character-profiles.ts, src/routes/connect-route.tsx, ralph/prd.json, ralph/progress.txt
- validation: cargo fmt --manifest-path worker/Cargo.toml; cargo check --manifest-path worker/Cargo.toml; npm run build:web
- commit: 66812ec

- timestamp: 2026-02-11
- item: RL-005
- summary: Added a 3-variant Retro Diffusion character sprite set, wired selector metadata/UI, enforced server-side sprite id allow-listing, and applied per-player sprite selection in WASM runtime rendering.
- decisions: Standardize on sprite ids (`engineer-default`, `surveyor-cyan`, `machinist-rose`) across web/worker/WASM; preserve fallback safety by normalizing unknown ids to default on client and rejecting unsupported ids on worker writes; ship a preset generator (`generate-character-set.mjs`) that regenerates assets plus `character-sprites.json` manifest.
- files: public/sprites/character-engineer-default.png, public/sprites/character-engineer-default.png.json, public/sprites/character-surveyor-cyan.png, public/sprites/character-surveyor-cyan.png.json, public/sprites/character-machinist-rose.png, public/sprites/character-machinist-rose.png.json, public/sprites/character-sprites.json, src/game/character-sprites.ts, src/routes/connect-route.tsx, src/game/types.ts, src/game/netcode/replication.ts, game-client/src/lib.rs, worker/src/lib.rs, retro-diffusion/generate-character-set.mjs, retro-diffusion/README.md, README.md, package.json, ralph/prd.json, ralph/progress.txt
- validation: cargo fmt --manifest-path worker/Cargo.toml; cargo fmt --manifest-path game-client/Cargo.toml; cargo check --manifest-path worker/Cargo.toml; cargo check --manifest-path game-client/Cargo.toml --target wasm32-unknown-unknown; npm run build:web
- commit: pending
