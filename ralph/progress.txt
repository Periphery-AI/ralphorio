# Ralph Loop Progress (v2 Continuation)

This file is session memory for iterative Ralph runs.

Continuation note:
- Previous v1 progress has been archived at `ralph/progress.archive.v1-2026-02-11.txt`.
- This v2 track builds on already-implemented multiplayer/gameplay systems and prioritizes stabilization + fun.

Entry format:
- timestamp:
- item:
- summary:
- decisions:
- files:
- validation:
- commit:

---

- timestamp: 2026-02-11
- item: RLP2-000
- summary: Reset Ralph artifacts for v2 scope; replaced PRD, prompt, and progress baseline; added dedicated gameplay design document.
- decisions: Keep old work archived instead of deleting history; move to a stricter vertical-slice definition-of-done focused on combat + crafting + placement + polished UI.
- files: ralph/prd.json, ralph/prompt.md, ralph/progress.txt, ralph/progress.archive.v1-2026-02-11.txt, docs/ralph-loop-gdd.md, README.md
- validation: jq . ralph/prd.json; test -s docs/ralph-loop-gdd.md
- commit: pending

- timestamp: 2026-02-11
- item: RLP2-001
- summary: pending
- decisions: pending
- files: pending
- validation: pending
- commit: pending

- timestamp: 2026-02-11
- item: RLP2-101
- summary: Completed enemy visibility path by wiring combat snapshots through replication into Bevy and rendering snapshot-driven enemy actors in-world with live despawn/update behavior.
- decisions: Keep server-authoritative combat state unchanged; client now treats enemies as render-only entities sourced from validated combat snapshots so existing projectile combat can target the visible positions.
- files: src/game/types.ts, src/game/netcode/replication.ts, game-client/src/lib.rs, ralph/progress.txt
- validation: npm run wasm:build:dev (pass); npm run build:web (pass)
- commit: 7dc82dc

- timestamp: 2026-02-11
- item: RLP2-102
- summary: Implemented authoritative placement validation feedback by reusing server placement rules for preview and placement commands, then surfacing `canPlace` + failure reason through protocol parsing into the in-room HUD and status/dev log.
- decisions: Kept existing authoritative placement/persistence flow and structure replication intact; added a single shared worker validation path (`evaluate_structure_placement`) so preview validity and actual placement rejection reasons stay aligned.
- files: worker/src/lib.rs, src/game/types.ts, src/game/network-client.ts, src/routes/room-route.tsx, game-client/src/lib.rs, ralph/progress.txt
- validation: cargo test (worker) (pass); cargo test (sim-core) (pass); npm run wasm:build:dev (pass); npm run build:web (pass)
- commit: d8adabf

- timestamp: 2026-02-11
- item: RLP2-102
- summary: Hardened placement consistency by extracting shared structure-cell availability checks and adding focused worker regression tests for blocked/allowed placement cells, then validated full worker + web build loops and closed the PRD item.
- decisions: Kept existing authoritative placement command and replication architecture; only refactored collision gating into a pure helper (`structure_cell_is_available`) to improve testability without rewriting build/inventory systems.
- files: worker/src/lib.rs, ralph/prd.json, ralph/progress.txt
- validation: cargo test --manifest-path worker/Cargo.toml (pass, 26 tests); cargo test --manifest-path sim-core/Cargo.toml (pass, 13 tests); npm run wasm:build:dev (pass); npm run build:web (pass)
- commit: pending

- timestamp: 2026-02-11
- item: RLP2-103
- summary: Removed the inventory-to-crafting gameplay blocker by adding direct in-game crafting controls (hotkeys queue/cancel authoritative crafting commands) and surfacing those controls in the room HUD so mined resources can immediately progress into craft outputs for building/combat recipes.
- decisions: Built on the existing server-authoritative crafting queue + build-cost consumption flow in the worker; no subsystem rewrites. Implemented client-side control wiring in Bevy (`crafting.queue` and `crafting.cancel`) and only added lightweight UI discoverability in `src`.
- files: game-client/src/lib.rs, src/routes/room-route.tsx, ralph/prd.json, ralph/progress.txt
- validation: cargo test --manifest-path worker/Cargo.toml (pass, 26 tests); cargo test --manifest-path sim-core/Cargo.toml (pass, 13 tests); npm run wasm:build:dev (pass); npm run build:web (pass)
- commit: pending

- timestamp: 2026-02-11
- item: RLP2-104
- summary: Reduced room HUD clutter by replacing the always-on multi-panel overlay with a compact tabbed command deck (inventory/crafting/build/telemetry), adding explicit minimize/show controls, and moving deep telemetry out of the top bar while keeping gameplay-critical information immediately accessible.
- decisions: Treated this as a focused UI slice on the existing room HUD architecture only (no subsystem rewrite); kept authoritative data surfaces unchanged and prioritized world visibility plus mobile-friendly panel switching over adding new panels.
- files: src/routes/room-route.tsx, ralph/progress.txt
- validation: npm run wasm:build:dev (pass); npm run lint (pass); npm run build:web (pass)
- commit: cd64152

- timestamp: 2026-02-11
- item: RLP2-104
- summary: Completed the connect-screen polish slice by replacing the dense per-slot editor stack with a compact active-slot flow, reframing lobby copy around the core gameplay loop, and keeping room entry actions clear on desktop/mobile layouts.
- decisions: Built on the existing profile fetch/save flow and route structure; no gameplay/network rewrites. Kept all character slots persisted per room but only expanded the currently active slot editor to reduce HUD/form noise while preserving inventory/crafting/build/combat discoverability once in-room.
- files: src/routes/connect-route.tsx, ralph/prd.json, ralph/progress.txt
- validation: npm run lint (pass); npm run build:web (pass)
- commit: 8504f4d

- timestamp: 2026-02-11
- item: RLP2-105
- summary: Tuned early-session pacing by adding a server-authoritative enemy warmup gate and lower spawn density, plus rebalanced the beacon build cost to require a craft-chain step before first placement.
- decisions: Kept the existing combat/materialization architecture and inserted a minimal `connected_at` readiness gate instead of rewriting enemy AI/spawn subsystems; enemies now only spawn/aggro for combat-ready players after a 75s grace window. Tightened beacon placement progression by requiring `gear` in addition to plates while preserving existing miner/assembler costs and replication rules.
- files: worker/src/lib.rs, ralph/progress.txt
- validation: cargo test --manifest-path worker/Cargo.toml (pass, 27 tests); cargo test --manifest-path sim-core/Cargo.toml (pass, 13 tests); npm run wasm:build:dev (pass); npm run build:web (pass)
- commit: 6a487b7

- timestamp: 2026-02-11
- item: RLP2-105
- summary: Completed the progression-clarity polish slice by adding server-authored gameplay objectives (gather -> smelt -> craft -> build -> fight -> expand) with warmup countdown, wiring that feature through strict snapshot parsing into a dedicated in-room Goals HUD panel, and retuning enemy warmup to 120s so first combat pressure lands after players establish starter flow.
- decisions: Built directly on existing authoritative inventory/crafting/build/combat runtime state and snapshot protocol; no subsystem rewrites. Added objective derivation in worker snapshots rather than client-only heuristics so goals stay consistent with authoritative state and malformed payload checks remain strict end-to-end.
- files: worker/src/lib.rs, src/game/types.ts, src/game/network-client.ts, src/game/netcode/replication.ts, src/routes/room-route.tsx, ralph/prd.json, ralph/progress.txt
- validation: cargo test --manifest-path worker/Cargo.toml (pass, 29 tests); cargo test --manifest-path sim-core/Cargo.toml (pass, 13 tests); npm run wasm:build:dev (pass); npm run build:web (pass); npm run lint (pass)
- commit: 7ee02c3

- timestamp: 2026-02-11
- item: RLP2-106
- summary: Improved authoritative combat readability by adding in-world enemy health bars and damage popups in Bevy, plus room HUD combat telemetry (HP/threat/attack/armor) and a low-health warning so combat state is readable without opening debug tooling.
- decisions: Built entirely on existing authoritative combat snapshots + combat event feed (no combat protocol rewrite). In-world cues are now derived from snapshot health deltas to align feedback with server-resolved outcomes while keeping module boundaries intact.
- files: game-client/src/lib.rs, src/routes/room-route.tsx, ralph/progress.txt
- validation: npm run wasm:build:dev (pass); npm run build:web (pass); npm run lint (pass)
- commit: pending

- timestamp: 2026-02-11
- item: RLP2-106
- summary: Closed the remaining combat readability gap by adding authoritative local-player damage/defeat popups in-world, keyed off combat snapshot health deltas so incoming hits are visible at the actor location instead of only in HUD/feed text.
- decisions: Kept the existing snapshot/event contract and avoided combat protocol rewrites; implemented feedback state as a lightweight client cache reset on session transitions to preserve Bevy system boundaries and avoid introducing non-authoritative cues.
- files: game-client/src/lib.rs, ralph/prd.json, ralph/progress.txt
- validation: npm run wasm:build:dev (pass); npm run build:web (pass); npm run lint (pass)
- commit: pending
